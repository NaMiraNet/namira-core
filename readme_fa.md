
# **هستهٔ نمیرآ (Namira Core)**  
*یک جعبه‌ابزار سریع و خودمیزبان برای تضمین کیفیت لینک‌های VMess / VLESS / Trojan / Shadowsocks*

---

<!-- فهرست مطالب -->
- [نمای کلی و هدف](#نمای-کلی-و-هدف)
- [برای کاربران غیر فنی (راهنمای ساده)](#برای-کاربران-غیر-فنی-راهنمای-ساده)
- [راهنمای نصب و ساخت](#راهنمای-نصب-و-ساخت)
  - [اجرای سریع با داکر (۲ دقیقه)](#اجرای-سریع-با-داکر-۲-دقیقه)
  - [راه‌اندازی API دائمی (حدود ۱۵ دقیقه)](#راهاندازی-api-دائمی-حدود-۱۵-دقیقه)
  - [ساخت از سورس (اختیاری)](#ساخت-از-سورس-اختیاری)
  - [خطاهای رایج و رفع آن‌ها](#خطاهای-رایج-و-رفع-آنها)
- [راهنمای استفاده](#راهنمای-استفاده)
  - [اسکن فوری از طریق CLI](#اسکن-فوری-از-طریق-cli)
  - [گردش‌کار API](#گردشکار-api)
  - [گزینه‌ها و پیکربندی پیشرفته](#گزینهها-و-پیکربندی-پیشرفته)
- [نگهداری و جامعه](#نگهداری-و-جامعه)
- [موارد ضروری مخزن](#موارد-ضروری-مخزن)
  - [مجوز](#مجوز)
  - [راهنمای مشارکت](#راهنمای-مشارکت)
  - [منشور رفتار](#منشور-رفتار)
  - [قالب‌های Issue و Pull Request](#قالبهای-issue-و-pull-request)
  - [پشتیبانی و تماس](#پشتیبانی-و-تماس)
- [چرخه انتشار و نسخه‌بندی](#چرخه-انتشار-و-نسخهبندی)

---

## نمای کلی و هدف
**Namira Core** یک سرویس سبک است که لینک‌های اشتراک VPN را **تجزیه، آزمایش، و رتبه‌بندی** می‌کند.

به‌جای اعتماد به لیستی تصادفی از لینک‌های `vmess://` یا `ss://`، Namira Core:

1. **لینک را تجزیه می‌کند** تا بررسی کند که آیا ساختار آن صحیح است.
2. **یک ارتباط واقعی TCP حداقلی** برقرار می‌کند (بسیار دقیق‌تر از یک پینگ ساده).
3. **تاخیر را به میلی‌ثانیه اندازه‌گیری می‌کند** تا عملکرد واقعی را نشان دهد.
4. **خروجی را به‌صورت فایل JSON** تمیز ارائه می‌دهد یا آن را به GitHub / تلگرام ارسال می‌کند.

> **چرا این مهم است؟**
> تاخیر و در دسترس‌بودن سرورها بسیار متغیر است. آزمون دستی کند، خطاپذیر، و ناقص است. Namira Core این روند را خودکار می‌کند و اطلاعات قابل سنجشی ارائه می‌دهد تا بتوانید سریع‌ترین و فعال‌ترین سرورها را انتخاب کنید.

---

## برای کاربران غیر فنی (راهنمای ساده)

> *مثال*: Namira Core مانند **رادار سرعت و چکاپ سلامت** برای کارت‌های عبور VPN است.

1. **لیست لینک‌های خود را** (مثلاً `links.txt`) وارد سیستم کنید.
2. سیستم **هر لینک را بررسی می‌کند** که آیا قابل خواندن است یا نه (بررسی فرمت).
3. سپس **در را با هر لینک امتحان می‌کند** تا ببیند کدام در واقعاً باز می‌شود (دست‌دادن TCP).
4. یک رادار **سرعت باز شدن در را اندازه می‌گیرد** (تاخیر).
5. در پایان **گزارش تمیز و رنگی به شما ارائه می‌دهد**: لینک‌های سبز سریع و معتبر هستند، قرمزها خراب‌اند.

### پیش‌نیازها به زبان ساده
| آنچه نیاز دارید | دلیل نیاز | معادل دنیای واقعی |
|----------------|-----------|--------------------|
| **Docker** نسخه 20.10 یا بالاتر | محیط ایزوله برای اجرای برنامه | شبیه نصب یک جعبه‌ماسه برای اجرای ابزار |
| **فایل متنی** شامل لینک‌ها | پشته‌ای از لینک‌ها جهت بررسی | فقط یک لیست URL کپی‌شده از ارائه‌دهنده‌تان |
| *(در حالت API)* **Redis** | صف موقت برای کارها | مانند یک دفترچه‌ی سریع برای ثبت وظایف |

---

## راهنمای نصب و ساخت

### اجرای سریع با داکر (۲ دقیقه)

```bash
docker run --rm -v "$PWD:/data" ghcr.io/namiranet/namira-core:latest check --config /data/links.txt
# نتایج در ./report.json ذخیره می‌شوند
```

> **نکته**: برای نمایش زیبا از `jq` استفاده کنید:
> `cat report.json | jq '.'`

### راه‌اندازی API دائمی (حدود ۱۵ دقیقه)

```bash
git clone https://github.com/NaMiraNet/namira-core.git
cd namira-core
cp .env.example .env        # حداقل مقدار API_KEY را تنظیم کنید
docker compose up --build -d
curl http://localhost:8080/health
```

| کانتینر | پورت | کاربرد |
|---------|------|--------|
| `namira-core` | 8080 | API و هماهنگ‌کننده کارها |
| `redis` | 6379 | بک‌اند صف پردازش |

### ساخت از سورس (اختیاری)

```bash
# نیاز دارد به: Go 1.22+, make, git, (اختیاری) upx
git clone https://github.com/NaMiraNet/namira-core.git
cd namira-core
make test        # اجرای تست‌ها
make build       # فایل اجرایی در ./bin/namira-core
```

*حجم فایل نهایی*: حدود ۸ مگابایت پس از فشرده‌سازی با UPX — قابل اجرا روی هر توزیع با glibc.

### خطاهای رایج و رفع آن‌ها

| نشانه | دلیل محتمل | راه‌حل |
|--------|-------------|--------|
| بلافاصله بسته‌شدن کانتینر | متغیر محیطی اشتباه | `docker logs namira-core` را بررسی کرده و `.env` را بازبینی کنید |
| تمام لینک‌ها زمان‌بر هستند | دیواره آتش خروجی TCP-80/443 را مسدود کرده | پورت‌ها را باز کرده یا به شبکه‌ای با محدودیت کمتر منتقل شوید |
| دریافت `401 Unauthorized` از API | هدر `X-API-Key` حذف شده | مقدار صحیح هدر را اضافه کنید |
| تاخیر زیاد | `CHECK_HOST` خیلی دور است | از IP نزدیک‌تر استفاده کنید، مثلاً `8.8.8.8:53` |

---

## راهنمای استفاده

### اسکن فوری از طریق CLI

```bash
./bin/namira-core check --config links.txt --timeout 10s --concurrency 50
```

### گردش‌کار API

```bash
# ارسال درخواست
curl -X POST http://localhost:8080/scan -H "X-API-Key: $API_KEY" -H "Content-Type: application/json" -d '{"configs": ["trojan://...", "vmess://..."]}'

# بررسی وضعیت
curl http://localhost:8080/job/<job_id>

# دریافت نتیجه نهایی
curl http://localhost:8080/job/<job_id>/result > result.json
```

### گزینه‌ها و پیکربندی پیشرفته

| متغیر / پارامتر | پیش‌فرض | توضیح |
|------------------|----------|--------|
| `--timeout, APP_TIMEOUT` | `10s` | مدت زمان تایم‌اوت برای هر لینک |
| `--concurrency, MAX_CONCURRENT` | `50` | تعداد پردازش‌های هم‌زمان |
| `CHECK_HOST` | `1.1.1.1:80` | مقصد بررسی تاخیر |
| `TELEGRAM_BOT_TOKEN` و `TELEGRAM_CHANNEL` | خالی | فعال‌سازی اطلاع‌رسانی تلگرام |
| `ENCRYPTION_KEY` | خالی | کلید AES-256 برای ارسال امن داده‌ها |

---

## نگهداری و جامعه

* **گزارش باگ** – یک Issue در GitHub باز کنید و لینک معیوب را (بدون اطلاعات حساس) پیوست کنید.
* **درخواست ویژگی جدید** – Issue را با برچسب *enhancement* باز کنید؛ گفت‌وگو آزاد است.
* **مشارکت در کد** – فورک کنید، یک شاخه ویژگی بسازید، `make test` اجرا کنید، PR ارسال نمایید.
* **بازبینی‌ها** – نگه‌دارنده‌ها هفتگی بررسی می‌کنند؛ مرج‌ها بر اساس نسخه‌های معنایی انجام می‌شود.

---

## موارد ضروری مخزن

### مجوز
این پروژه تحت مجوز **MIT** توزیع شده است. متن کامل در [`LICENSE`](LICENSE).

### راهنمای مشارکت
راهنمای مختصر در [`CONTRIBUTING.md`](CONTRIBUTING.md) در مورد سبک کد، پیام‌های کامیت (`feat:`, `fix:` و غیره)، و تست‌ها وجود دارد.

### منشور رفتار
ما از [Contributor Covenant v2.1](CODE_OF_CONDUCT.md) پیروی می‌کنیم. هرگونه آزار، نفرت‌پراکنی یا اسپم منجر به مسدودی خواهد شد.

### قالب‌های Issue و Pull Request
قالب‌ها در `.github/ISSUE_TEMPLATE/` و `.github/PULL_REQUEST_TEMPLATE.md` موجود هستند؛ این قالب‌ها رعایت الزامات و بازتولیدپذیری را تضمین می‌کنند.

### پشتیبانی و تماس
* **تلگرام**: <https://t.me/NamiraNet>  
* **وبسایت**: `https://namira-web.vercel.app`  
* **ایمیل**: `namiranet [at] proton.me`  
* **گفت‌وگوهای GitHub**: برای هرگونه سوال عمومی آزاد است.

---

*با تردید سالم ساخته شده—هر لینک باید ارزش خود را ثابت کند.*
